<!-- <link href="css/shared.css?v=1.0.0.16" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js" type="text/javascript"></script> -->
<style>
    #profile-single {
        color: var(--color-dynamic-1);
    }

    #profile-single .cls-flex>div {
        margin: 0;
    }

    #profile-single i {
        margin-right: 0.6em;
        color: var(--gray-1);
        font-weight: bold;
    }

    #profile-single [name="avatar"] img {
        border-radius: 50%;
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    #profile-single *[name="name"] {
        font-size: 1.8em;
        text-transform: capitalize !important;
        color: #000;
        margin-bottom: 0.3em;
    }

    #profile-single .fa-heart {
        color: red;
    }

    #profile-single *[name="articlecontent"][type="full"] {
        display: none;
    }

    #profile-single *[name="likes"]:hover {
        cursor: pointer;
    }

    #profile-single-banner {
        position: relative;
        box-shadow: rgba(0, 0, 0, 0.05) 0px 1px 2px 0px;
        margin: 1em;
    }

    #profile-single-banner [name="banner"] {
        height: 250px;
    }

    #profile-single-banner [name="banner"] img {
        height: 100%;
        width: 100%;
        object-fit: cover;
        border-bottom-left-radius: 0.5em;
        border-bottom-right-radius: 0.5em;
    }

    #profile-single-banner #dvUserInfo {
        position: absolute;
        top: 150px;
        left: 2em;
        right: 2em;
    }

    #profile-single-banner #dvUserInfo #dvAvatar {
        justify-content: flex-start;
        padding-bottom: 2em;
        border-bottom: var(--border);
        border-color: var(--gray-1-blur-60);
    }

    #profile-single-banner #dvUserInfo #dvAvatar [name="avatar"] {
        border-radius: 50%;
        border: 5px solid var(--white);
        width: 12em;
    }

    #profile-single-banner #dvUserInfo #dvAvatar #dvName {
        padding-top: 120px;
        padding-left: 2em;
        font-weight: bold;
    }

    #profile-single-banner #dvUserInfo #dvAvatar #dvName>.cls-flex>div {
        margin-right: 1em;
        font-size: 0.9em;
    }

    #profile-single-content {
        margin-top: 140px;
        background-color: var(--gray-2);
    }

    #profile-single-content>div:not(#dvButton) {
        display: none;
    }

    #profile-single-content #dvButton {
        justify-content: flex-start;
        padding: 1em 2em 0 2em;
        background-color: var(--white);
        box-shadow: rgba(0, 0, 0, 0.45) 0px 15px 20px -20px;
    }

    #profile-single-content #dvButton>div {
        margin-right: 1em;
        font-weight: bold;
        padding: 0.6em;
        color: var(--gray-1);
    }

    #profile-single-content #dvButton>div:hover {
        background-color: var(--gray-1-blur-20);
        cursor: pointer;
    }

    #profile-single-content #dvButton>div.clicked {
        color: var(--color-dynamic-1);
        border-bottom: var(--border);
        border-color: var(--color-dynamic-1);
        border-width: 3px;
    }

    #profile-single-content .dvContent {
        padding: 2em;
    }

    #profile-single-content .dvContentDiv {
        margin: 1em 0;
        background-color: var(--white);
        padding: 2em;
        border-radius: 1em;
        box-shadow: rgba(9, 30, 66, 0.25) 0px 4px 8px -2px, rgba(9, 30, 66, 0.08) 0px 0px 0px 1px;
    }

    #profile-single-content #dvAbout>div:first-child {
        width: 20em;
        margin-right: 3em;
    }

    #profile-single-content #dvAbout>div:last-child {
        flex: 1;
    }

    #profile-single-content #dvAbout>div:last-child>div:nth-child(2n+1) {
        font-weight: bold;
        font-size: 1.2em;
    }

    #profile-single-content #dvAbout #dvAboutInfo>div:not(:last-child) {
        margin-bottom: 1.4em;
    }

    #profile-single-content .title {
        font-size: 1.5em;
        font-weight: bold;
        margin-bottom: 0.6em;
    }

    #profile-single-content *[name="aboutme"] {
        text-align: center;
        padding-bottom: 1em;
        border-bottom: var(--border);
        border-color: var(--gray-1-blur-60);
    }

    #profile-single-content .title-post>div:first-child {
        width: 2.5em;
        height: 2.5em;
    }

    #profile-single-content .title-post>div:last-child {
        flex: 1;
        font-size: 0.65em;
        padding-left: 1em;
        font-weight: bold;
        text-transform: capitalize;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    #profile-single-content .title-post .date-create {
        justify-content: flex-start;
    }

    #profile-single-content .title-post .date-create>div {
        margin-right: 0.6em;
    }

    #profile-single-content .title-post .date-create i {
        margin-right: 0;
    }

    #profile-single-content .content-post>div {
        margin: 1.5em 0;
    }

    #profile-single-content .content-post>div:first-child {
        font-weight: bold;
        font-size: 1.2em;
    }

    #profile-single-content .content-post b[name="seemore"] {
        font-weight: bold;
    }

    #profile-single-content .content-post b[name="seemore"]:hover {
        cursor: pointer;
        text-decoration: underline;
    }

    @media only screen and (max-width: 992px) {
        #profile-single-banner #dvUserInfo #dvAvatar {
            flex-direction: column !important;
            justify-content: space-between;
            align-items: center;
        }

        #profile-single-banner #dvUserInfo #dvAvatar #dvName {
            padding: 0;
            text-align: center;
        }

        #profile-single-content {
            margin-top: 200px;
        }

        #profile-single-content .dvContentDiv.cls-flex {
            flex-direction: column;
        }

        #profile-single-content .dvContentDiv.cls-flex>div:not(:last-child) {
            margin-bottom: 2em;
        }

        #profile-single-content #dvAbout>div:first-child {
            width: unset;
            text-align: center;
        }
    }
</style>

<div id="profile-single">
    <div id="profile-single-banner">
        <div name="banner"></div>
        <div id="dvUserInfo">
            <div id="dvAvatar" class="cls-flex">
                <div name="avatar"></div>
                <div id="dvName">
                    <div name="name"><span></span></div>
                    <div class="cls-flex">
                        <div name="position"><i class="fa-solid fa-circle-info"></i><span></span></div>
                        <div name="title"><i class="fa-solid fa-paper-plane"></i><span></span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="profile-single-content" name="id">
        <div id="dvButton" class="cls-flex">
            <div id="btnAbout">Thông tin</div>
            <div id="btnPost">Bài viết</div>
            <!-- <div id="btnFile">Chia sẻ</div> -->
        </div>
        <div name="btnAbout" class="dvContent">
            <div id="dvAbout" class="cls-flex dvContentDiv">
                <div id="dvAboutInfo">
                    <div class="title">Giới thiệu</div>
                    <div name="aboutme"><span></span></div>
                    <div name="office"><i class="fa-solid fa-building"></i><span></span></div>
                    <div name="phone"><i class="fa-solid fa-phone"></i><span></span></div>
                    <div name="email"><i class="fa-solid fa-envelope"></i><span></span></div>
                    <div name="education"><i class="fa-solid fa-user-graduate"></i><span></span></div>
                    <div name="major"><i class="fa-solid fa-magnifying-glass"></i><span></span></div>
                </div>
                <div id="dvAboutPost">
                    <div><i class="fa-solid fa-microscope"></i><span>Công Trình Nghiên Cứu</span></div>
                    <div name="research"><span></span></div>
                    <div><i class="fa-solid fa-hand-holding-hand"></i><span>Đề Tài Ứng Dụng</span></div>
                    <div name="supervision"><span></span></div>
                    <div><i class="fa-solid fa-book-open"></i><span>Ấn Phẩm Xuất Bản</span></div>
                    <div name="publication"><span></span></div>
                    <div><i class="fa-solid fa-chalkboard-user"></i><span>Bộ Môn Giảng Dạy</span></div>
                    <div name="teachingcourse"><span></span></div>
                </div>
            </div>
        </div>
        <div name="btnPost" class="dvContent"></div>
    </div>
</div>

<script>
    // let uri_api = "https://dhqt.api.phuckhanggem.com/";
    // let uri_img = "https://dhqt.phuckhanggem.com/ftp_images/";
    $(function () {
        var lang = localStorage.getItem('lang');
        var user_id = getUrlParameter("user-id");
        // user_id = 20;

        loadItem(lang, user_id);
        $('#profile-single-content #dvButton>div').click(function () {
            $('#profile-single-content #dvButton>div').removeClass('clicked');
            $(this).addClass('clicked');
            let id = $(this).attr('id');
            $('#profile-single-content>div:not(#dvButton)').hide();
            $(`#profile-single-content>div[name="${id}"]`).show();
        });
        loadPostBlog(lang, user_id, 1);

        $(window).scroll(function () {
            let height = Math.round($('div[name="btnPost"]').height() - 550);
            var currentScroll = $(this).scrollTop();
            if (currentScroll >= height) {
                let pageload = parseInt($('div[name="btnPost"]').attr('current-page')) + 1;
                loadPostBlog(localStorage.getItem('lang'), user_id, pageload);
            }
            previousScroll = currentScroll;
        });

        $('#profile-single-content #btnAbout').trigger('click');
        loadLang(lang);
    });
    function loadPostBlog(lang, id, sotrang) {
        if ($('div[name="btnPost"]').attr("max-page") === undefined) {
            $.ajax({
                type: 'POST',
                url: uri_api + "store/StoredProcedure",
                data: JSON.stringify({
                    "loai": 21,
                    "iduser": id,
                    "lang": lang,
                    "sotrang": sotrang,
                    "soitem": 5,
                }),
                dataType: "json",
                contentType: "application/json",
                async: false,
                globle: false,
                success: function (su) {
                    if (su.message === "success") {
                        let p = su.responses;
                        if (p.length > 0) {
                            let keys = Object.keys(su.responses[0]);
                            let html = `<div id="dvPostBlog" class="dvContentDiv">`;
                            html += `<div class="title-post cls-flex">`;
                            html += `<div name="avatar"></div>`;
                            html += `<div>`;
                            html += `<div name="name"><span></span></div>`;
                            html += `<div class="cls-flex date-create">`;
                            html += `<div><i class="fa-solid fa-earth-asia"></i></div>`;
                            html += `<div><span>·</span></div>`;
                            html += `<div name="createdate"><span></span></div>`;
                            html += `</div>`;
                            html += `</div>`;
                            html += `</div>`;
                            html += `<div class="content-post">`;
                            html += `<div name="title"><span></span></div>`;
                            html += `<div name="articlecontent" type="short"><span></span></div>`;
                            html += `<div name="articlecontent" type="full"><span></span></div>`;
                            html += `<div name="hastag"><span></span></div>`;
                            html += `<div name="likes"><i class="fa-regular fa-heart"></i><span></span></div>`;
                            html += `</div>`;
                            html += `</div>`;
                            keys.push("name"); keys.push("avatar");
                            $.map(p, function (i) {
                                let div = $(html);
                                i.name = sessionStorage.getItem("name");
                                i.avatar = sessionStorage.getItem("avatar");
                                $.map(keys, function (k) {
                                    let va = i[k];
                                    if (k === "articlecontent") {
                                        if ($(va).text().length > 250) {
                                            let vashort = $(va).text().substr(0, 250);
                                            if (vashort.indexOf(" ") > -1)
                                                vashort = vashort.substr(0, va.lastIndexOf(" ")) + "...";
                                            vashort += "<b name='seemore' postid='" + i.id + "'>Xem thêm</b>";
                                            div.find(`div[name="${k}"][type="short"] > span`).html(vashort);
                                            div.find(`div[name="${k}"][type="full"] > span`).html(va);
                                        }
                                        else
                                            div.find(`div[name="${k}"][type="full"] > span`).html(va);
                                    }
                                    else if (k === "avatar")
                                        $(`div[name="${k}"]`).html(`<img src="${uri_img + i[k]}" />`);
                                    else
                                        div.find(`div[name="${k}"] > span`).html(va);
                                    div.find(`div[name="${k}"]`).attr('postid', i.id);
                                });
                                div.attr('postid', i.id);
                                $('div[name="btnPost"]').append(div);
                                $('div[name="btnPost"]').attr("current-page", sotrang);
                            });
                        }
                        else
                            $('div[name="btnPost"]').attr("max-page", "true");
                    }
                },
                error: function (er) {
                    console.log(er)
                }
            });

            loadEventForPostBlog();
        }
    }

    function loadEventForPostBlog() {
        $('#profile-single-content .content-post div[name="likes"]').click(function () {
            let like = 0;
            let liked = parseInt($(this).children('span').text());
            let htmllike = `<i class="fa-regular fa-heart"></i><span></span>`;
            let htmlunlike = `<i class="fa-solid fa-heart"></i><span></span>`;
            if ($(this).children('i').hasClass('fa-regular')) {
                $(this).html(htmlunlike);
                like = 1;
            }
            else {
                $(this).html(htmllike);
                like = -1;
            }
            $(this).children('span').text(liked + like);

            $.ajax({
                type: 'POST',
                url: uri_api + "store/StoredProcedure",
                data: JSON.stringify({
                    "loai": 4,
                    "id": $(this).attr('postid'),
                    "alike": like
                }),
                dataType: "json",
                contentType: "application/json",
                success: function (su) {
                    // console.log(su)
                },
                error: function (er) {
                    console.log(er)
                }
            });
        });

        $('#profile-single-content .content-post b[name="seemore"]').click(function () {
            let postid = $(this).attr('postid');
            $(`#profile-single-content .content-post div[name="articlecontent"][type="short"][postid="${postid}"]`).hide();
            $(`#profile-single-content .content-post div[name="articlecontent"][type="full"][postid="${postid}"]`).show();
        });
    }

    function loadItem(lang, id) {
        $.ajax({
            type: 'POST',
            url: uri_api + "store/StoredProcedure",
            data: JSON.stringify({
                "loai": 81,
                "id": id,
                "lang": lang,
            }),
            dataType: "json",
            contentType: "application/json",
            success: function (su) {
                if (su.message === "success" && su.responses.length > 0) {
                    let i = su.responses[0];
                    let keys = Object.keys(i);
                    $.map(keys, function (k) {
                        if (k === "phone")
                            $(`div[name="${k}"] > span`).html(`<a href="tel:${i[k]}">${i[k]}</a>`);
                        else if (k === "banner")
                            $(`div[name="${k}"]`).html(`<img src="${uri_img + i[k]}" />`);
                        else if (k === "avatar") {
                            $(`div[name="${k}"]`).html(`<img src="${uri_img + i[k]}" />`);
                            sessionStorage.setItem("avatar", i[k]);
                        }
                        else if (k === "email")
                            $(`div[name="${k}"] > span`).html(`<a href="mailto:${i[k]}">${i[k]}</a>`);
                        else {
                            $(`div[name="${k}"] > span`).html(i[k]);
                            if (k === "name") sessionStorage.setItem("name", i[k]);
                        }
                    });
                }
            },
            error: function (er) {
                console.log(er)
            }
        });
    }
</script>